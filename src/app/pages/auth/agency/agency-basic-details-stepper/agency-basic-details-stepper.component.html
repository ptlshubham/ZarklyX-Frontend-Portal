<div class="grid lg:grid-cols-2 grow min-h-[95vh]">
    <div class="flex justify-center items-center p-8  lg:p-10 order-2 lg:order-1">
        <div class="kt-card max-w-[370px] w-full">
            <!-- 470 -->

            <form [formGroup]="agencyForm" (ngSubmit)="onSubmit()" class="kt-card-content flex flex-col gap-5 p-6"
                id="agency_details_form">
                <!-- Stepper Header -->
                <div class="text-center mb-1">
                    <h3 class="text-lg font-medium text-mono leading-none">
                        @if (currentStep === 1) {
                        Select Your Business Areas
                        } @else if (currentStep === 2) {
                        Select Your Account Type
                        } @else if (currentStep === 3) {
                        Company Details
                        } @else if (currentStep === 4) {
                        How many clients do you have?
                        } @else if (currentStep === 5) {
                        Select Our Premium Modules
                        }
                    </h3>

                </div>

                <!-- Stepper Progress -->
                <div class="flex items-center gap-2 mb-2">
                    <div class="flex-1 h-2 rounded-full" [class.bg-primary]="currentStep >= 1"
                        [class.bg-gray-200]="currentStep < 1"></div>
                    <div class="flex-1 h-2 rounded-full" [class.bg-primary]="currentStep >= 2"
                        [class.bg-gray-200]="currentStep < 2"></div>
                    <div class="flex-1 h-2 rounded-full" [class.bg-primary]="currentStep >= 3"
                        [class.bg-gray-200]="currentStep < 3"></div>
                    <div class="flex-1 h-2 rounded-full" [class.bg-primary]="currentStep >= 4"
                        [class.bg-gray-200]="currentStep < 4"></div>
                    <div class="flex-1 h-2 rounded-full" [class.bg-primary]="currentStep >= 5"
                        [class.bg-gray-200]="currentStep < 5"></div>
                </div>

                <!-- Step 1: Business Areas -->
                @if (currentStep === 1) {
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-3">
                        <!-- <label class="kt-form-label font-normal text-mono text-center">
                            Select Your Business Areas <span class="text-red-500">*</span>
                        </label> -->
                        <p class="text-sm text-secondary-foreground text-center mb-2">Choose one or more areas that
                            apply to your business</p>

                        <div class="flex flex-wrap gap-2 justify-center">
                            @for (option of businessAreaOptions; track option.value) {
                            <button type="button" (click)="toggleBusinessArea(option.value)"
                                class="kt-badge inline-flex items-center gap-2 px-3 py-3.5 rounded-lg text-[14px] font-normal transition-all whitespace-nowrap border-gray-300"
                                [class.kt-badge-primary]="isBusinessAreaSelected(option.value)"
                                [class.kt-badge-outline]="!isBusinessAreaSelected(option.value)">
                                <i class="ki-outline text-base" [ngClass]="option.icon"></i>
                                <span>{{ option.label }}</span>
                                @if (isBusinessAreaSelected(option.value)) {
                                <i class="ki-filled ki-cross text-xs"></i>
                                }
                            </button>
                            }
                        </div>
                    </div>

                    <button type="button" (click)="nextStep()" class="kt-btn kt-btn-primary flex justify-center grow"
                        [disabled]="!isStepValid()">
                        Continue to Next Step
                    </button>
                </div>
                }

                <!-- Step 2: Account Type -->
                @if (currentStep === 2) {
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-3">
                        <!-- <label class="kt-form-label font-normal text-mono text-center">
                            Select Your Account Type <span class="text-red-500">*</span>
                        </label> -->

                        <div class="grid grid-cols-1 gap-4">
                            @for (option of accountTypeOptions; track option.value) {
                            <button type="button" (click)="toggleAccountType(option.value)"
                                class="kt-btn kt-btn-outline flex justify-start items-center p-6 h-auto"
                                [class.kt-btn-primary]="isAccountTypeSelected(option.value)"
                                [class.border-primary]="isAccountTypeSelected(option.value)">
                                <div class="flex items-start gap-4 w-full">
                                    <i class="ki-filled text-3xl mt-1" [ngClass]="option.icon"
                                        [class.text-white]="isAccountTypeSelected(option.value)"></i>
                                    <div class="flex-1 text-left">
                                        <div class="text-base font-semibold "
                                            [class.text-white]="isAccountTypeSelected(option.value)">{{ option.label }}
                                        </div>
                                        <div class="text-sm text-secondary-foreground"
                                            [class.text-white]="isAccountTypeSelected(option.value)">{{
                                            option.description }}</div>
                                    </div>
                                </div>
                            </button>
                            }
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button type="button" (click)="previousStep()"
                            class="kt-btn kt-btn-outline flex justify-center grow">
                            Back
                        </button>
                        <button type="button" (click)="nextStep()"
                            class="kt-btn kt-btn-primary flex justify-center grow" [disabled]="!isStepValid()">
                            Continue
                        </button>
                    </div>
                </div>
                }

                <!-- Step 3: Company Details -->
                @if (currentStep === 3) {
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-1">
                        <label class="kt-form-label font-normal text-mono">
                            Company Name <span class="text-red-500">*</span>
                        </label>
                        <input class="kt-input"
                            [class.kt-input-error]="f['companyName'].invalid && (f['companyName'].touched || submitted)"
                            [class.border-red-500]="f['companyName'].invalid && (f['companyName'].touched || submitted)"
                            placeholder="Enter company name" type="text" formControlName="companyName" required />
                        @if (f['companyName'].invalid && (f['companyName'].touched || submitted)) {
                        <div class="kt-form-message">
                            @if (f['companyName'].errors?.['required']) {
                            Company name is required
                            }
                        </div>
                        }
                    </div>

                    <div class="flex flex-col gap-1">
                        <label class="kt-form-label font-normal text-mono">
                            Website
                        </label>
                        <input class="kt-input"
                            [class.kt-input-error]="f['website'].invalid && (f['website'].touched || submitted)"
                            [class.border-red-500]="f['website'].invalid && (f['website'].touched || submitted)"
                            placeholder="https://example.com" type="url" formControlName="website" />
                        @if (f['website'].invalid && (f['website'].touched || submitted)) {
                        <div class="kt-form-message">
                            @if (f['website'].errors?.['pattern']) {
                            Please enter a valid website URL
                            }
                        </div>
                        }
                    </div>
                    <!-- <div class="flex gap-3"> -->

                    <div class="flex flex-col gap-1 flex-1">
                        <label class="kt-form-label font-normal text-mono">
                            Country <span class="text-red-500">*</span>
                        </label>
                        <select #countrySelect class="kt-select"
                            [class.kt-input-error]="f['country'].invalid && (f['country'].touched || submitted)"
                            [class.border-red-500]="f['country'].invalid && (f['country'].touched || submitted)"
                            data-kt-select="true" data-kt-select-enable-search="true"
                            data-kt-select-search-placeholder="Search..." data-kt-select-placeholder="Select country"
                            data-kt-select-config='{"optionsClass": "kt-scrollable overflow-auto max-h-[250px]"}'
                            formControlName="country" required>
                            <option value="">Select country</option>
                            @for (country of countries; track country) {
                            <option [value]="country">{{ country }}</option>
                            }
                        </select>
                        @if (f['country'].invalid && (f['country'].touched || submitted)) {
                        <div class="kt-form-message">
                            @if (f['country'].errors?.['required']) {
                            Country is required
                            }
                        </div>
                        }
                    </div>

                    <div class="flex flex-col gap-1 flex-1">
                        <label class="kt-form-label font-normal text-mono">
                            Timezone <span class="text-red-500">*</span>
                        </label>
                        <select #timezoneSelect class="kt-select"
                            [class.kt-input-error]="f['timezone'].invalid && (f['timezone'].touched || submitted)"
                            [class.border-red-500]="f['timezone'].invalid && (f['timezone'].touched || submitted)"
                            data-kt-select="true" data-kt-select-enable-search="true"
                            data-kt-select-search-placeholder="Search..." data-kt-select-placeholder="Select timezone"
                            data-kt-select-config='{
                                    "optionsClass": "kt-scrollable overflow-auto max-h-[250px]"
                                }' formControlName="timezone" required>
                            <option value="">Select timezone</option>
                            @for (tz of timezones; track tz) {
                            <option [value]="tz">{{ tz }}</option>
                            }
                        </select>
                        @if (f['timezone'].invalid && (f['timezone'].touched || submitted)) {
                        <div class="kt-form-message">
                            @if (f['timezone'].errors?.['required']) {
                            Timezone is required
                            }
                        </div>
                        }
                    </div>
                    <!-- </div> -->

                    <div class="flex gap-2">
                        <button type="button" (click)="previousStep()"
                            class="kt-btn kt-btn-outline flex justify-center grow">
                            Back
                        </button>
                        <button type="button" (click)="nextStep()"
                            class="kt-btn kt-btn-primary flex justify-center grow" [disabled]="!isStepValid()">
                            Continue
                        </button>
                    </div>
                </div>
                }

                <!-- Step 4: Client Count -->
                @if (currentStep === 4) {
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-3">
                        <!-- <label class="kt-form-label font-normal text-mono text-center">
                            How many clients do you have? <span class="text-red-500">*</span>
                        </label> -->

                        <div class="grid grid-cols-2 gap-3">
                            @for (range of clientRanges; track range.value) {
                            <label class="kt-btn kt-btn-outline justify-start cursor-pointer"
                                [class.kt-btn-primary]="f['client'].value === range.value"
                                [class.border-primary]="f['client'].value === range.value">
                                <input type="radio" [value]="range.value" formControlName="client" class="sr-only" />
                                <span class="flex items-center gap-2">
                                    @if (f['client'].value === range.value) {
                                    <i class="ki-filled ki-check text-lg text-white"></i>
                                    }
                                    <span [class.text-white]="f['client'].value === range.value">{{ range.label
                                        }}</span>
                                </span>
                            </label>
                            }
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button type="button" (click)="previousStep()"
                            class="kt-btn kt-btn-outline flex justify-center grow">
                            Back
                        </button>
                        <button type="button" (click)="nextStep()"
                            class="kt-btn kt-btn-primary flex justify-center grow" [disabled]="!isStepValid()">
                            Continue
                        </button>
                    </div>
                </div>
                }

                <!-- Step 5: Select Module -->
                @if (currentStep === 5) {
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-3">
                        <!-- <label class="kt-form-label font-normal text-mono text-center">
                            Select Your Modules <span class="text-red-500">*</span>
                        </label> -->
                        <p class="text-sm text-secondary-foreground text-center mb-2">Choose the modules you want to use
                        </p>

                        <div class="flex flex-wrap gap-2 justify-center">
                            @for (module of moduleOptions; track module.value) {
                            <button type="button" (click)="toggleModule(module.value)"
                                class="kt-badge inline-flex items-center gap-2 px-3 py-3.5 rounded-lg text-[14px] font-normal transition-all whitespace-nowrap border-gray-300"
                                [class.kt-badge-primary]="isModuleSelected(module.value)"
                                [class.kt-badge-outline]="!isModuleSelected(module.value)">
                                <i class="ki-outline text-base" [ngClass]="module.icon"></i>
                                <span>{{ module.label }}</span>
                                @if (isModuleSelected(module.value)) {
                                <i class="ki-filled ki-check text-xs"></i>
                                }
                            </button>
                            }
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button type="button" (click)="previousStep()"
                            class="kt-btn kt-btn-outline flex justify-center grow">
                            Back
                        </button>
                        <button type="submit" class="kt-btn kt-btn-primary flex justify-center grow"
                            [disabled]="!isStepValid() || isLoading">
                            @if (isLoading) {
                            <span>Submitting...</span>
                            } @else {
                            <span>Complete Setup</span>
                            }
                        </button>
                    </div>
                </div>
                }
            </form>
        </div>
    </div>
    <div class="lg:rounded-xl lg:border lg:border-border lg:m-5 order-1 lg:order-2 bg-top xxl:bg-center xl:bg-cover bg-no-repeat branded-bg"
        [ngClass]="getStepBgClass()">
        <div class="flex flex-col justify-between h-full p-8 lg:p-16">
            <div class="flex flex-col gap-4">
                <a href="html/demo1.html">
                    <img class="h-[28px] max-w-none" src="/assets/media/app/mini-logo.svg" />
                </a>
                <div class="flex flex-col gap-3">
                    <h3 class="text-2xl font-semibold text-mono">
                        Welcome to ZarklyX
                    </h3>
                    <div class="text-base font-medium text-secondary-foreground">
                        Let's get started by setting up
                        <br />
                        your
                        <span class="text-mono font-semibold">
                            profile
                        </span>
                        and understanding
                        <br />
                        your business needs.
                    </div>
                </div>
            </div>
            <div class="flex-1"></div>
        </div>
    </div>
    @if (isLoading) {
    <div class="loading-overlay">
        <div class="loader">
            <div class="spinner"></div>
            <p class="text-white text-lg font-medium">Submitting...</p>
        </div>
    </div>
    }
</div>